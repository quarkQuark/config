<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2021-09-04 Sat 15:17 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Emacs configuration</title>
<meta name="generator" content="Org mode" />
<meta name="author" content="root" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  /* Languages per Org manual */
  pre.src-asymptote:before { content: 'Asymptote'; }
  pre.src-awk:before { content: 'Awk'; }
  pre.src-C:before { content: 'C'; }
  /* pre.src-C++ doesn't work in CSS */
  pre.src-clojure:before { content: 'Clojure'; }
  pre.src-css:before { content: 'CSS'; }
  pre.src-D:before { content: 'D'; }
  pre.src-ditaa:before { content: 'ditaa'; }
  pre.src-dot:before { content: 'Graphviz'; }
  pre.src-calc:before { content: 'Emacs Calc'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-fortran:before { content: 'Fortran'; }
  pre.src-gnuplot:before { content: 'gnuplot'; }
  pre.src-haskell:before { content: 'Haskell'; }
  pre.src-hledger:before { content: 'hledger'; }
  pre.src-java:before { content: 'Java'; }
  pre.src-js:before { content: 'Javascript'; }
  pre.src-latex:before { content: 'LaTeX'; }
  pre.src-ledger:before { content: 'Ledger'; }
  pre.src-lisp:before { content: 'Lisp'; }
  pre.src-lilypond:before { content: 'Lilypond'; }
  pre.src-lua:before { content: 'Lua'; }
  pre.src-matlab:before { content: 'MATLAB'; }
  pre.src-mscgen:before { content: 'Mscgen'; }
  pre.src-ocaml:before { content: 'Objective Caml'; }
  pre.src-octave:before { content: 'Octave'; }
  pre.src-org:before { content: 'Org mode'; }
  pre.src-oz:before { content: 'OZ'; }
  pre.src-plantuml:before { content: 'Plantuml'; }
  pre.src-processing:before { content: 'Processing.js'; }
  pre.src-python:before { content: 'Python'; }
  pre.src-R:before { content: 'R'; }
  pre.src-ruby:before { content: 'Ruby'; }
  pre.src-sass:before { content: 'Sass'; }
  pre.src-scheme:before { content: 'Scheme'; }
  pre.src-screen:before { content: 'Gnu Screen'; }
  pre.src-sed:before { content: 'Sed'; }
  pre.src-sh:before { content: 'shell'; }
  pre.src-sql:before { content: 'SQL'; }
  pre.src-sqlite:before { content: 'SQLite'; }
  /* additional languages in org.el's org-babel-load-languages alist */
  pre.src-forth:before { content: 'Forth'; }
  pre.src-io:before { content: 'IO'; }
  pre.src-J:before { content: 'J'; }
  pre.src-makefile:before { content: 'Makefile'; }
  pre.src-maxima:before { content: 'Maxima'; }
  pre.src-perl:before { content: 'Perl'; }
  pre.src-picolisp:before { content: 'Pico Lisp'; }
  pre.src-scala:before { content: 'Scala'; }
  pre.src-shell:before { content: 'Shell Script'; }
  pre.src-ebnf2ps:before { content: 'ebfn2ps'; }
  /* additional language identifiers per "defun org-babel-execute"
       in ob-*.el */
  pre.src-cpp:before  { content: 'C++'; }
  pre.src-abc:before  { content: 'ABC'; }
  pre.src-coq:before  { content: 'Coq'; }
  pre.src-groovy:before  { content: 'Groovy'; }
  /* additional language identifiers from org-babel-shell-names in
     ob-shell.el: ob-shell is the only babel language using a lambda to put
     the execution function name together. */
  pre.src-bash:before  { content: 'bash'; }
  pre.src-csh:before  { content: 'csh'; }
  pre.src-ash:before  { content: 'ash'; }
  pre.src-dash:before  { content: 'dash'; }
  pre.src-ksh:before  { content: 'ksh'; }
  pre.src-mksh:before  { content: 'mksh'; }
  pre.src-posh:before  { content: 'posh'; }
  /* Additional Emacs modes also supported by the LaTeX listings package */
  pre.src-ada:before { content: 'Ada'; }
  pre.src-asm:before { content: 'Assembler'; }
  pre.src-caml:before { content: 'Caml'; }
  pre.src-delphi:before { content: 'Delphi'; }
  pre.src-html:before { content: 'HTML'; }
  pre.src-idl:before { content: 'IDL'; }
  pre.src-mercury:before { content: 'Mercury'; }
  pre.src-metapost:before { content: 'MetaPost'; }
  pre.src-modula-2:before { content: 'Modula-2'; }
  pre.src-pascal:before { content: 'Pascal'; }
  pre.src-ps:before { content: 'PostScript'; }
  pre.src-prolog:before { content: 'Prolog'; }
  pre.src-simula:before { content: 'Simula'; }
  pre.src-tcl:before { content: 'tcl'; }
  pre.src-tex:before { content: 'TeX'; }
  pre.src-plain-tex:before { content: 'Plain TeX'; }
  pre.src-verilog:before { content: 'Verilog'; }
  pre.src-vhdl:before { content: 'VHDL'; }
  pre.src-xml:before { content: 'XML'; }
  pre.src-nxml:before { content: 'XML'; }
  /* add a generic configuration mode; LaTeX export needs an additional
     (add-to-list 'org-latex-listings-langs '(conf " ")) in .emacs */
  pre.src-conf:before { content: 'Configuration File'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .equation-container {
    display: table;
    text-align: center;
    width: 100%;
  }
  .equation {
    vertical-align: middle;
  }
  .equation-label {
    display: table-cell;
    text-align: right;
    vertical-align: middle;
  }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  .org-svg { width: 90%; }
  /*]]>*/-->
</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2020 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">Emacs configuration</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#org1109b31">1. Installation</a></li>
<li><a href="#orgb897893">2. Package Management</a></li>
<li><a href="#org9eace45">3. User Interface</a>
<ul>
<li><a href="#org5d1d272">3.1. Theme</a></li>
</ul>
</li>
<li><a href="#org502fb60">4. Keybindings and Evil Mode</a></li>
<li><a href="#org9e8ac3c">5. Completion</a>
<ul>
<li><a href="#org3cb6d95">5.1. Interactively open dotfiles</a></li>
</ul>
</li>
<li><a href="#orgfe03b11">6. Programming</a>
<ul>
<li><a href="#orgdaeaf0a">6.1. Emacs Lisp</a></li>
<li><a href="#org648a805">6.2. Haskell</a></li>
</ul>
</li>
<li><a href="#orgf85849a">7. Magit</a></li>
<li><a href="#orgabee29b">8. Org Mode</a>
<ul>
<li><a href="#org33823b4">8.1. Babel</a></li>
</ul>
</li>
<li><a href="#orgb915550">9. LaTeΧ</a></li>
<li><a href="#org05bae13">10. Projectile</a></li>
<li><a href="#org1dcae2c">11. Miscellaneous</a></li>
</ul>
</div>
</div>

<div id="outline-container-org1109b31" class="outline-2">
<h2 id="org1109b31"><span class="section-number-2">1</span> Installation</h2>
<div class="outline-text-2" id="text-1">
<p>
Emacs expects to find user configuration in <code>.config/emacs/init.el</code>.  This <b>literate configuration file</b> must be <b>tangled</b> in order to generate that file and apply the configuration. Once Emacs is installed, this can be done from the command line with the following command:
</p>

<div class="org-src-container">
<pre class="src src-shell">
emacs --batch -l org --eval '(org-babel-tangle-file "~/.config/emacs/README.org")'

</pre>
</div>

<p>
Make sure to also download the fonts <a href="https://github.com/tonsky/FiraCode">Fira Code</a> and <a href="https://edwardtufte.github.io/et-book/">ET Book</a> (known to emacs as <code>ETBembo</code>):
</p>

<div class="org-src-container">
<pre class="src src-shell">
sudo pacman -S ttf-fira-code
yay -S ttf-et-book

</pre>
</div>

<p>
When Emacs is launched for the first time, it will spend some time downloading and installing various packages.
</p>
</div>
</div>

<div id="outline-container-orgb897893" class="outline-2">
<h2 id="orgb897893"><span class="section-number-2">2</span> Package Management</h2>
<div class="outline-text-2" id="text-2">
<p>
Most of the rest of the configuration depends on Emacs' vast array of extensions. Therefore the first thing that must be configured is the package manager. Emacs' default package manager is simply called <code>package</code>. Even though it is built-in, we still have to do a little work to initialise it!
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
;; Where to look for packages to download.
(setq package-archives
      '(("melpa"        . "https://melpa.org/packages/")
	("melpa-stable" . "https://stable.melpa.org/packages/")
	("org"          . "https://orgmode.org/elpa/")
	("elpa"         . "https://elpa.gnu.org/packages/")))

(package-initialize)
(unless package-archive-contents package-refresh-contents)

</pre>
</div>

<p>
Package management can be made much more convenient with <a href="https://github.com/jwiegley/use-package">use-package</a>. We begin by installing it with <code>package</code>, but after this all packages will be installed through <code>use-package</code>.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
;; Install use-package ...
(unless (package-installed-p 'use-package)
  (package-install 'use-package))

;; ... and enable it.
(require 'use-package)

</pre>
</div>

<p>
By default, <code>use-package</code> only loads packages which already exist on the system. The following setting tells it to handle downloading packages as well.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(setq use-package-always-ensure t)

</pre>
</div>
</div>
</div>

<div id="outline-container-org9eace45" class="outline-2">
<h2 id="org9eace45"><span class="section-number-2">3</span> User Interface</h2>
<div class="outline-text-2" id="text-3">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(scroll-bar-mode -1)    ; Disable scrollbar.
(tool-bar-mode -1)      ; Disable toolbar.
(menu-bar-mode -1)      ; Disable menu bar.
(tooltip-mode -1)       ; Disable tooltips.
(set-fringe-mode 10)    ; Add breathing room.
(column-number-mode)    ; Show column number in modeline.
(size-indication-mode)  ; Show file size in modeline.

(defun quark/display-line-numbers ()
  "My preferences for line numbers where desired."
  (setq-local display-line-numbers 'visual
	      display-line-numbers-current-absolute t))

(add-hook 'prog-mode-hook 'quark/display-line-numbers)

;; Scrolls way too fast by default.
(setq mouse-wheel-scroll-amount '(1 ((control) . 'text-scale))
      scroll-margin 3
      scroll-step 1)

(use-package all-the-icons)
(use-package minions)
(use-package doom-modeline
  :init
  (doom-modeline-mode)
  (minions-mode)
  :custom
  (doom-modeline-buffer-encoding nil)
  (doom-modeline-minor-modes t))

;; Pop-up to make keybindings discoverable.
(use-package which-key
  :init (which-key-mode)
  :custom (which-key-idle-delay 0.3))

;; Preview colour codes
(use-package rainbow-mode
  :config (rainbow-mode))

</pre>
</div>
</div>

<div id="outline-container-org5d1d272" class="outline-3">
<h3 id="org5d1d272"><span class="section-number-3">3.1</span> Theme</h3>
<div class="outline-text-3" id="text-3-1">
<p>
Enabling <a href="https://github.com/hlissner/emacs-solaire-mode">Solaire mode</a> slightly dims the backgrounds of non-editing buffers. This draws the eye to the editing space and gives the window a more refined look. Themes need to be configured to work with this. The package <a href="https://github.com/hlissner/emacs-doom-themes">doom-themes</a> contains many nice preconfigured themes.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package solaire-mode
  :config (solaire-global-mode))

(use-package doom-themes
  :config (doom-themes-org-config))

</pre>
</div>

<p>
Liked dark themes:
</p>
<ul class="org-ul">
<li><code>doom-vibrant</code> <i>(default Doom Emacs theme, with slightly more contrast).</i></li>
<li><code>doom-nord</code> <i>(Nord. Rather low contrast).</i></li>
<li><code>doom-palenight</code> <i>(Used by System Crafters. Elegant and slightly purple).</i></li>
</ul>

<p>
Liked light themes:
</p>
<ul class="org-ul">
<li><code>doom-one-light</code> <i>(Default Doom Emacs light theme).</i></li>
</ul>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(load-theme 'doom-one-light t)

(set-face-attribute 'default        nil :font "Fira Code Retina" :height 101)
(set-face-attribute 'fixed-pitch    nil :font "Fira Code Retina" :height 101)
(set-face-attribute 'variable-pitch nil :font "ETBembo"          :height 120)

</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-org502fb60" class="outline-2">
<h2 id="org502fb60"><span class="section-number-2">4</span> Keybindings and Evil Mode</h2>
<div class="outline-text-2" id="text-4">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package general
  :config
  (general-evil-setup)
  (general-create-definer my-leader-def       :states 'normal :prefix "SPC")
  (general-create-definer my-local-leader-def :states 'normal :prefix "SPC m")
  (my-leader-def
    "b" 'counsel-switch-buffer
    "f" '(:ignore t :which-key "files")
    "ff" 'find-file))

(defun quark/load-dotfile ()
  "Reload emacs configuration."
  (interactive)
  (load-file (expand-file-name "~/.config/emacs/init.el")))

(my-leader-def
  "e" '(:ignore t :which-key "eval")
  "eb" 'eval-buffer
  "ed" 'quark/load-dotfile
  "ee" 'eval-last-sexp)

(general-def
  "C-=" `text-scale-increase
  "C--" `text-scale-decrease)

;; Required for C-r (evil-mode undo).
(use-package undo-tree
  :init (global-undo-tree-mode))

(use-package evil
  :init
  (setq evil-move-cursor-back nil
	evil-want-keybinding nil ;; For evil-collection.
	evil-want-Y-yank-to-eol 1
	evil-undo-system 'undo-tree)
  :config
  (evil-mode)
  (general-def "&lt;escape&gt;" 'keyboard-escape-quit) ; Make ESC quit prompts.
  (general-def evil-insert-state-map "C-g" 'evil-normal-state)
  (general-def 'normal "j" 'evil-next-visual-line)
  (general-def 'normal "k" 'evil-previous-visual-line))

(use-package evil-collection
  :after evil
  :config (evil-collection-init))

;; Escape insert mode with "jk".
(general-imap "j" (general-key-dispatch 'self-insert-command
		    :timeout 0.25
		    "k" 'evil-normal-state))

</pre>
</div>
</div>
</div>

<div id="outline-container-org9e8ac3c" class="outline-2">
<h2 id="org9e8ac3c"><span class="section-number-2">5</span> Completion</h2>
<div class="outline-text-2" id="text-5">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package ivy
  :bind
  (("C-s" . swiper)
   :map ivy-minibuffer-map
   ("TAB" . ivy-alt-done)
   ("C-l" . ivy-alt-done)
   ("C-j" . ivy-next-line)
   ("C-k" . ivy-previous-line)
   :map ivy-switch-buffer-map
   ("C-k" . ivy-previous-line)
   ("C-l" . ivy-done)
   ("C-d" . ivy-switch-buffer-kill)
   :map ivy-reverse-i-search-map
   ("C-k" . ivy-previous-line)
   ("C-d" . ivy-reverse-i-search-kill))
  :config (ivy-mode))

(use-package ivy-rich
  :init (ivy-rich-mode))

(use-package counsel
  :config (counsel-mode))

</pre>
</div>
</div>

<div id="outline-container-org3cb6d95" class="outline-3">
<h3 id="org3cb6d95"><span class="section-number-3">5.1</span> Interactively open dotfiles</h3>
<div class="outline-text-3" id="text-5-1">
<p>
This command (bound to <code>SPC f d</code>) allows me to search for and open dotfiles.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(defun quark/ivy-find-file-action (key)
  "Find dotfile from KEY in quark/dotfile-list."
  (with-ivy-window (find-file (cdr (assoc key quark/dotfile-list)))))

;; A list of dotfiles, each associated with a keyword.
(setq quark/dotfile-list
      '(("Dotfiles README" . "~/README.md")
	("Emacs"           . "~/.config/emacs/README.org")
	("XMonad"          . "~/.config/xmonad/README.md")))

(defun quark/ivy-open-dotfile ()
  "Open configuration file for PROGRAM."
  (interactive)
  (ivy-read "Open dotfile: " (mapcar 'car quark/dotfile-list)
	    :action 'quark/ivy-find-file-action))

(my-leader-def "fd" 'quark/ivy-open-dotfile)

</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgfe03b11" class="outline-2">
<h2 id="orgfe03b11"><span class="section-number-2">6</span> Programming</h2>
<div class="outline-text-2" id="text-6">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
;; More easily see how parentheses pair up.
(use-package rainbow-delimiters
  :hook (prog-mode . rainbow-delimiters-mode))

;; Automatically close parentheses.
(use-package smartparens
  :hook (prog-mode . smartparens-mode)
  :config (require 'smartparens-config))

(use-package lsp-mode
  :commands (lsp lsp-deferred)
  :custom (lsp-keymap-prefix "C-c l")
  :config (lsp-enable-which-key-integration t))

(use-package lsp-ui)

(use-package company
  :hook (lsp-mode . company-mode)
  :bind
  (:map company-active-map ("&lt;tab&gt;" . company-complete-selection))
  (:map lsp-mode-map ("&lt;tab&gt;" . company-indent-or-complete-common))
  :custom
  (company-minimum-prefix-length 1)
  (company-idle-delay 0.0))

;; Make the ui slightly nicer (I'm not entirely sure if it's worth it).
(use-package company-box
  :hook (company-mode-hook . company-box-mode))

(use-package evil-nerd-commenter
  :bind ("M-/" . evilnc-comment-or-uncomment-lines))

</pre>
</div>
</div>

<div id="outline-container-orgdaeaf0a" class="outline-3">
<h3 id="orgdaeaf0a"><span class="section-number-3">6.1</span> Emacs Lisp</h3>
<div class="outline-text-3" id="text-6-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
;; Be strict about parentheses.
(add-hook 'emacs-lisp-mode-hook 'smartparens-strict-mode)
(use-package evil-cleverparens
  :hook (emacs-lisp-mode . evil-cleverparens-mode))

</pre>
</div>
</div>
</div>

<div id="outline-container-org648a805" class="outline-3">
<h3 id="org648a805"><span class="section-number-3">6.2</span> Haskell</h3>
<div class="outline-text-3" id="text-6-2">
<p>
Lsp-mode requires <code>haskell-language-server</code>. If running Arch Linux, make sure to install <code>haskell-language-server-bin</code> from the Arch User Repository instead of <code>haskell-language-server</code> from the official repositories. The Arch official repositories use dynamic linking for Haskell packages, which leads to many messy dependency problems when installing or upgrading any Haskell package.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package lsp-haskell
  :hook (haskell-mode . lsp-deferred))

</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgf85849a" class="outline-2">
<h2 id="orgf85849a"><span class="section-number-2">7</span> Magit</h2>
<div class="outline-text-2" id="text-7">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package magit)
(use-package git-gutter
  :init (global-git-gutter-mode))

</pre>
</div>

<p>
I backup all my <a href="https://github.com/quarkQuark/dotfiles">dotfiles</a> using a git bare repository. It is difficult for Emacs to tell automatically whether I want to use magit on my dotfiles repository or some other repository, as they can overlap. Following <a href="https://emacs.stackexchange.com/questions/30602/use-nonstandard-git-directory-with-magit">this Stackexchange answer</a>, I set up alternative commands to launch Magit explicitly with the correct settings.
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
;; Add args when used for dotfiles or remove args otherwise.
(setq dotfiles-git-dir (concat "--git-dir=" (expand-file-name "~/.dotfiles-git")))
(setq dotfiles-work-tree (concat "--work-tree=" (expand-file-name "~")))

(defun quark/dotfiles-magit-status ()
  "Open magit to manage my dotfiles git bare repository."
  (interactive)
  (add-to-list 'magit-git-global-arguments dotfiles-git-dir)
  (add-to-list 'magit-git-global-arguments dotfiles-work-tree)
  (call-interactively 'magit-status))

(defun quark/magit-status ()
  "Replacement for `magit-status' for compatibility with quark/dotfiles-magit-status."
  (interactive)
  (setq magit-git-global-arguments (remove dotfiles-git-dir magit-git-global-arguments))
  (setq magit-git-global-arguments (remove dotfiles-work-tree magit-git-global-arguments))
  (call-interactively 'magit-status))

(general-def "C-x g" 'quark/magit-status)
(general-def magit-file-mode-map "C-x g" 'quark/magit-status)

(my-leader-def
  "g" '(:ignore t :which-key "git")
  "gd" '(quark/dotfiles-magit-status :which-key "dotfiles-magit-status")
  "gg" '(quark/magit-status          :which-key "magit-status"))

</pre>
</div>
</div>
</div>

<div id="outline-container-orgabee29b" class="outline-2">
<h2 id="orgabee29b"><span class="section-number-2">8</span> Org Mode</h2>
<div class="outline-text-2" id="text-8">
<p>
<a href="https://zzamboni.org/post/beautifying-org-mode-in-emacs/">https://zzamboni.org/post/beautifying-org-mode-in-emacs/</a>
</p>

<div class="org-src-container">
<pre class="src src-emacs-lisp">
(defun quark/org-mode-setup ()
  "Function to run on `org-mode' startup."
  (variable-pitch-mode)
  (visual-line-mode)
  (quark/org-font-setup)
  (setq evil-auto-indent nil))

(use-package org
  :hook (org-mode . quark/org-mode-setup)
  :custom
  (org-ellipsis " ▾")
  (org-hide-emphasis-markers t)
  (org-startup-indented t)
  (org-startup-with-latex-preview t)
  (org-format-latex-options '(plist-put org-format-latex-options :scale 1.2)))

(use-package org-superstar
  :after org
  :hook (org-mode . org-superstar-mode)
  :custom
  (org-superstar-headline-bullets-list '("◉" "○" "●" "►" "◇")))

;; Unhide emphasis markers under cursor.
(use-package org-appear
  :hook (org-mode . org-appear-mode))

;; Automatically toggle latex preview under cursor
(use-package org-fragtog
  :hook (org-mode . org-fragtog-mode))

(use-package cdlatex
  :hook (org-mode . org-cdlatex-mode))

(defun quark/org-font-setup ()
  "Set up my font preferences for `org-mode'."

  ;; Prettify list bullets.
  ;; Seems to work only sometimes?
  (font-lock-add-keywords
   'org-mode
   '(("^ *\\([-]\\) "
      (0 (prog1 () (compose-region (match-beginning 1) (match-end 1) "•"))))))

  ;; Set heading font sizes.
  (set-face-attribute 'org-document-title nil :font "ETBembo" :weight 'bold :height 2.0)
  (dolist (face '((org-level-1 . 1.75)
		  (org-level-2 . 1.5)
		  (org-level-3 . 1.25)
		  (org-level-4 . 1.1)
		  (org-level-5 . 1.0)
		  (org-level-6 . 1.0)
		  (org-level-7 . 1.0)
		  (org-level-8 . 1.0)))
    (set-face-attribute (car face) nil :font "ETBembo" :weight 'medium :height (cdr face)))

  ;; Display certain regions in a fixed-pitch font.
  (set-face-attribute 'org-block nil           :foreground nil :inherit 'fixed-pitch)
  (set-face-attribute 'org-checkbox nil        :inherit 'fixed-pitch)
  (set-face-attribute 'org-code nil            :inherit '(shadow fixed-pitch))
  (set-face-attribute 'org-indent nil          :inherit '(org-hide fixed-pitch))
  (set-face-attribute 'org-formula nil         :inherit 'fixed-pitch)
  (set-face-attribute 'org-meta-line nil       :inherit '(font-lock-comment-face fixed-pitch))
  (set-face-attribute 'org-special-keyword nil :inherit '(font-lock-comment-face fixed-pitch))
  (set-face-attribute 'org-table nil           :inherit '(shadow fixed-pitch))
  (set-face-attribute 'org-verbatim nil        :inherit '(shadow fixed-pitch)))

(defun quark/org-mode-visual-fill ()
  "Configure `visual-fill-column-mode' for `org-mode'."
  (setq visual-fill-column-width 100
	visual-fill-column-center-text t)
  (visual-fill-column-mode))

(use-package visual-fill-column
  :hook (org-mode . quark/org-mode-visual-fill))

(with-eval-after-load 'ox-latex
  (setq org-latex-compiler "lualatex")
  (setq org-latex-pdf-process '("latexmk -%latex -pvc -view=none %f"))
  (add-to-list 'org-latex-classes
	       '("my-notes"
		 "\\documentclass{my-notes}"
		 ;; Commands for each heading type (further subheadings become lists).
		 ("\\section{%s}" . "\\section*{%s}")
		 ("\\subsection{%s}" . "\\subsection*{%s}")
		 ("\\subsubsection{%s}" . "\\subsubsection*{%s}")))
  (add-to-list 'org-latex-classes
	       '("uonmathreport-colour"
		 "\\documentclass{uonmathreport-colour}"
		 ;; Commands for each heading type (further subheadings become lists).
		 ("\\section{%s}" . "\\section*{%s}")
		 ("\\subsection{%s}" . "\\subsection*{%s}")
		 ("\\subsubsection{%s}" . "\\subsubsection*{%s}")))
  (setq org-latex-default-class "my-notes"))

</pre>
</div>
</div>

<div id="outline-container-org33823b4" class="outline-3">
<h3 id="org33823b4"><span class="section-number-3">8.1</span> Babel</h3>
<div class="outline-text-3" id="text-8-1">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
;; List of languages org-babel can evaluate.
(org-babel-do-load-languages
  'org-babel-load-languages
  '((emacs-lisp . t)
    (python . t)))

(setq org-confirm-babel-evaluate nil)

;; Enable structure templates.
(require 'org-tempo)

(dolist (template
	 '(("el" . "src emacs-lisp")
	   ("sh" . "src shell")
	   ("py" . "src python")
	   ("hs" . "src haskell")
	   ("def" . "definition")
	   ("rem" . "remark")
	   ("lem" . "lemma")
	   ("thm" . "theorem")
	   ("cor" . "corollary")
	   ("prf" . "proof")))
  (add-to-list 'org-structure-template-alist template))

;; Recognise extra languages
(push '("conf-unix" . conf-unix) org-src-lang-modes)
(push '("latex" . latex) org-src-lang-modes)

</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgb915550" class="outline-2">
<h2 id="orgb915550"><span class="section-number-2">9</span> LaTeΧ</h2>
<div class="outline-text-2" id="text-9">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package tex
  :ensure auctex)

;; Mostly just to enable system fonts.
(setq TeX-engine "lualatex")

</pre>
</div>
</div>
</div>

<div id="outline-container-org05bae13" class="outline-2">
<h2 id="org05bae13"><span class="section-number-2">10</span> Projectile</h2>
<div class="outline-text-2" id="text-10">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
(use-package projectile
  :pin melpa-stable
  :init (projectile-mode)
  :bind-keymap ("C-c p" . projectile-command-map))

(use-package counsel-projectile
  :after projectile
  :init (counsel-projectile-mode))

(my-leader-def
  "SPC" 'projectile-find-file
  "p" '(:ignore t :which-key "projects")
  "pp" 'projectile-switch-project)

</pre>
</div>
</div>
</div>

<div id="outline-container-org1dcae2c" class="outline-2">
<h2 id="org1dcae2c"><span class="section-number-2">11</span> Miscellaneous</h2>
<div class="outline-text-2" id="text-11">
<div class="org-src-container">
<pre class="src src-emacs-lisp">
;; More helpful help pages.
(use-package helpful
  :custom
  (counsel-describe-function-function #'helpful-callable)
  (counsel-describe-variable-function #'helpful-variable)
  :bind
  ([remap describe-comand] . helpful-command)
  ([remap describe-key] . helpful-key))

;; Manage .pacnew and .pacsave files on Arch Linux.
(use-package pacfiles-mode)

</pre>
</div>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: root</p>
<p class="date">Created: 2021-09-04 Sat 15:17</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
